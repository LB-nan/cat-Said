---
layout: post
title: 前端基础巩固扩展
categories: javascript
description: 单元测试知识点整理
keywords: Web, Dom, CSS, JavaScript
---

前端知识点小记。

### 1、简介

整理自拉钩教育《前端高手进阶》课程以及部分内容结合自己的知识和理解。

### 2、标签

主要记录一些非常重要却容易被忽视的标签。

#### 2.1 mate标签

假设要实现一个类似 PPT 自动播放的效果，可以通过mate标签来实现。

```js
<meta http-equiv="Refresh" content="5; URL=page2.html">
```

上面的代码会在 5s 之后自动跳转到同域下的 page2.html 页面。



#### 2.2 script标签

浏览器的解析机制：在渲染解析HTML的过程中，如果遇到script标签引用文件，会暂停解析HTML，然后去下载js文件，文件下载完成后执行，执行完成后再继续渲染HTML。

这个机制就导致`script`标签会阻塞渲染过程，延长了用户看到页面的时间，降低了用户体验。

可以通过`script`标签的属性来规避这个问题。

1. `async`属性：立即请求文件，但不阻塞渲染引擎，而是文件加载完毕后阻塞渲染引擎并立即执行文件内容。
2. `defer`属性：立即请求文件，但不阻塞渲染引擎，等到解析完 HTML 之后再执行文件内容。
3. HTML5 标准`type`属性：对应值为“module”。让浏览器按照 ECMA Script 6 标准将文件当作模块进行解析，默认阻塞效果同 defer，也可以配合 async 在请求完成后立即执行。


除此之外还应当注意，当渲染引擎解析 HTML 遇到 script 标签引入文件时，会立即进行一次渲染。所以这也就是为什么构建工具会把编译好的引用 JavaScript 代码的 script 标签放入到 body 标签底部，因为当渲染引擎执行到 body 底部时会先将已解析的内容渲染出来，然后再去请求相应的 JavaScript 文件。如果是内联脚本（即不通过 src 属性引用外部脚本文件直接在 HTML 编写 JavaScript 代码的形式），渲染引擎则不会渲染。


#### 2.3 link标签

合理利用link标签的`rel`属性值来进行预加载，能进一步提升渲染速度。

1. `dns-prefetch`：当 link 标签的 rel 属性值为“dns-prefetch”时，浏览器会对某个域名预先进行 DNS 解析并缓存。这样，当浏览器在请求同域名资源的时候，能省去从域名查询 IP 的过程，从而减少时间损耗。
2. `preconnect`：让浏览器在一个HTTP请求正式发送给服务器前预先执行一些操作，包括DNS 解析、TLS 协商、TCP 握手，消除往返延迟的时间。
3. `prefetch/preload`：两个值都是让浏览器预先下载并缓存某个资源，但不同的是，prefetch 可能会在浏览器忙时被忽略，而 preload 则是一定会被预先下载。
4. `prerender`：浏览器不仅会预加载资料，还会解析执行页面，进行预渲染。


### 3、DOM

DOM：Document Object Model，文档对象模型


#### 3.1 为什么说DOM操作耗时

- 如果你对浏览器结构有一定了解，就会知道浏览器包含渲染引擎（也称浏览器内核）和 JavaScript 引擎，它们都是单线程运行。单线程的优势是开发方便，避免多线程下的死锁、竞争等问题，劣势是失去了并发能力。
- 
- 浏览器为了避免两个引擎同时修改页面而造成渲染结果不一致的情况，增加了另外一个机制，这两个引擎具有互斥性，也就是说在某个时刻只有一个引擎在运行，另一个引擎会被阻塞。操作系统在进行线程切换的时候需要保存上一个线程执行时的状态信息并读取下一个线程的状态信息，俗称上下文切换。而这个操作相对而言是比较耗时的。
- 
- 每次 DOM 操作就会引发线程的上下文切换——从 JavaScript 引擎切换到渲染引擎执行对应操作，然后再切换回 JavaScript 引擎继续执行，这就带来了性能损耗。单次切换消耗的时间是非常少的，但是如果频繁地大量切换，那么就会产生性能问题。

#### 3.2 重排（Reflow）与重绘（Repaint）

1. 重排：修改元素的盒模型或者改了浏览器的DOM节点或者视口宽高会触发重排。
2. 重绘：修改了元素的颜色之类的不会影响计算的属性只会发生重绘。

#### 3.3 如何高效操作DOM

老生常谈的话题，根据以上原因就可以找到方案

1. 尽量不要使用复杂的匹配规则和复杂的样式，从而减少渲染引擎计算样式规则生成 CSSOM 树的时间；
2. 尽量减少重排和重绘影响的区域；
3. 使用 CSS3 特性来实现动画效果。



