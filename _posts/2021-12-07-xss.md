---
layout: post
title: XSS详解
categories: 网络安全
description: XSS详解
keywords: XSS详解
---

XSS详解 xss漏洞的利用和防护

### 1、XSS 漏洞介绍

XSS 攻击全称跨站脚本攻击，是为不和层叠样式表(Cascading Style Sheets, CSS)的缩写混淆，故将跨站脚本攻击缩写为 XSS，XSS 是一种在 web 应用中的计算机安全漏洞，它允许恶意 web 用户将代码植入到 web 网站里面，供给其它用户访问，当用户访问到有恶意代码的网页就会产生 xss 攻击。

### 2、XSS  攻击的危害包括

1. 盗取各类用户帐号，如机器登录帐号、用户网银帐号、各类管理员帐号
2. 控制企业数据，包括读取、篡改、添加、删除企业敏感数据的能力
3. 盗窃企业重要的具有商业价值的资料
4. 非法转账
5. 强制发送电子邮件
6. 网站挂马
7. 控制受害者机器向其它网站发起攻击

### 3、XSS  防御

XSS 防御的总体思路是：对输入(和 URL 参数)进行过滤，对输出进行编码。也就是对提交的所有内容进行过滤，对 url 中的参数进行过滤，过滤掉会导致脚本执行的相关内容；然后对动态输出到页面的内容进行 html 编码，使脚本无法在浏览器中执行。

### 4、XSS 分类

分为：

1. 反射型XSS
2. 存储型XSS
3. DOM型XSS

#### 4.1 反射型XSS

反射型 XSS，非持久化，需要欺骗用户自己去点击链接才能触发 XSS 代码。反射型 xss 攻击的方法，攻击者通过发送邮件或诱导等方法，将包含有 xss 恶意链接发送给目标用户，当目标用户访问该链接时，服务器将接收该用户的请求并进行处理，然后服务器把带有 xss 恶意脚本发送给目标用户的浏览器，浏览器解析这段带有 xss 代码的恶意脚本后，就会触发 xss 攻击。

```txt
http://192.168.3.16/01/vulnerabilities/xss_r/?name=1<script>alert(1)</script>
```

具体实际情况的理论：

- 在目标网站的基础上构建一个攻击链接，如上，把攻击语句换成一个请求某个域名的链接，发送给受害人访问
- 当受害人点击构建的攻击链接的时候，攻击链接里构建的请求会被执行
- 请求执行会携带受害人的登录信息，如`cookie`，这个cookie会存到请求的地址的日志或者其他地方
- 然后攻击人查看登录信息就可以拿这个cookie去登录目标网站

#### 4.2 存储型 xss

存储型 XSS，持久化，代码是存储在服务器中的数据库里，如在个人信息或发表文章等地方，可以插入代码，如果插入的数据没有过滤或过滤不严，那么这些恶意代码没有经过过滤将储存到数据库中，用户访问该页面的时候，没有进行编码过滤输出到浏览器上，就会触发代码执行，造成 xss 攻击。

存储型和反射性的操作差不多，只不过存储型是会把攻击语句存到服务端数据库中然后再返回给前端页面，导致每个访问这个页面的人都会受到攻击，而反射性只有点击链接的被害人才会受到攻击。

#### 4.3  dom  型 xss

DOM 型 XSS 其实是一种特殊类型的反射型 XSS，它是基于 DOM 文档对象模型的一种漏洞。

在网站页面中有许多页面的元素，当页面到达浏览器时浏览器会为页面创建一个顶级的 Document object 文档对象，接着生成各个子文档对象，每个页面元素对应一个文档对象，每个文档对象包含属性、方法和事件。可以通过 JS 脚本对文档对象进行编辑从而修改页面的元素。也就是说，客户端的脚本程序可以通过DOM 来动态修改页面内容，从客户端获取 DOM 中的数据并在本地执行。基于这个特性，就可以利用 JS 脚本来实现 XSS 漏洞的利用。

一些经常出现 dom xss 的关键语句：

1. document.referer 属性
2. window.name 属性
3. location 属性
4. innerHTML 属性
5. documen.write 属性

有代码如下，进行构建语句攻击

```html
<script>
    function domxss(){
        var str = document.getElementById("text").value;
        document.getElementById("dom").innerHTML = "<a href='"+str+"'>what do you see?</a>";
    }
</script>

<input id="button" type="button" value="click me!" onclick="domxss()">
```

尝试构建语句如下

```txt
//试试：'><img src="#" onmouseover="alert('xss')">
//试试：' onclick="alert('xss')">,闭合掉就行

<a href='" ' onclick="alert('xss')">  "'>what do you see?</a>"
```

### 4、xss常用测试语句

在网站是否存在 xss 漏洞时，应该输入一些标签如<、>输入后查看网页源代码是否过滤标签，如果没过滤，很大可能存在 xss 漏洞。

```txt
<h5>1</h5>
<span>1</span>
<script>console.log(1);</script>
闭合
"><span>x</span><"
'>"><span>x</span><'
单行注释
"><span>x</span>//
```

