---
layout: post
title: SQL语句
categories: 数据库
description: 数据库基础,SQL语句
keywords: 数据库基础,SQL语句
---

数据库SQL语句

### 1、存储引擎

针对不同的数据格式需要对应不同的存储方式和处理机制。存储引擎就是不同的处理机制。

MySQL主要存储引擎：

1. innodb：是MySQL5.5版本之后的默认存储引擎,存储数据更加安全
2. myisam：是MySQL5.5版本之前的默认存储引擎，myisam比innodb速度要快，但是没它安全
3. memory：内存引擎，数据全部存放在内存中，速度快，但是不能永久保存数据，断电就数据丢失
4. blackhole：无论存什么都立刻消失

查看所有的存储引擎

```sql
show engines;
```

#### 1.1 不同引擎创建表

用不同的引擎创建四个表

```sql
use db2;

create table t3(id int) engine=innodb;     # 会产生两个文件，`frm`表结构和`ibd`表数据
create table t4(id int) engine=myisam;     # 会产生三个文件，`fm`表结构 `myd`表数据  `myi`索引
create table t5(id int) engine=memory;     # 会产生一个`frm`表结构的文件，数据在内存，无需文件存储
create table t6(id int) engine=blackhole;  # 会产生一个`frm`表结构的文件，写进去就丢失，不会有表数据
```

### 2、创建表的完整语法

```sql
create table 表名(
  字段名1 类型 (宽度) 约束条件,
  字段名1 类型 (宽度) 约束条件,
  ...
)
```

- 宽度：一般情况下指的是对存储数据的限制,在5.6版本默认没有开启严格模式，规定只能存一个字符，字符存多了就自动截取，5.7版本及以上或开启了严格模式的话，那么规定存几个就不能超，一旦超出就报错。MySQL5.7版本之后默认开启`严格模式`
  - `create table t1(name char)`：默认宽度是1
  - 当默认宽度是1的时候，我们插入一个数据`insert info t1 values('abcdef')`
  - 然后查看这张表`select * from t1` 会看到`name`的字段只有一个`a`
- 约束条件：比如创建表的时候加了结束`create table t2(id int, name char not null)`,然后插入的时候就不能插入null`insert into t2(2, null);` 这样会报错

宽度和约束条件的区别：

1. 宽度是用来限制数据的存储
2. 约束条件是在宽度的基础上增加的额外的约束

注意事项：

1. 同一张表中字段名不能重复
2. 宽度和约束条件是可选的，字段名和字段类型是必选的，约束条件写的话也可以写多个
3. 创建字段的时候最后一行不能有逗号

#### 2.1 严格模式

查看是否严格模式，看`sql_mode`

```sql
show variables like '%mode';

-- +--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------+
-- | Variable_name            | Value                                                                                                                                     |
-- +--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------+
-- | block_encryption_mode    | aes-128-ecb                                                                                                                               |
-- | gtid_mode                | OFF                                                                                                                                       |
-- | innodb_autoinc_lock_mode | 1                                                                                                                                         |
-- | innodb_strict_mode       | ON                                                                                                                                        |
-- | offline_mode             | OFF                                                                                                                                       |
-- | pseudo_slave_mode        | OFF                                                                                                                                       |
-- | rbr_exec_mode            | STRICT                                                                                                                                    |
-- | slave_exec_mode          | STRICT                                                                                                                                    |
-- | sql_mode                 | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION |
-- +--------------------------+-------------------------------------------------------------------------------------------------------------------------------------------+
-- 9 rows in set (0.00 sec)
```

- 模糊匹配 'mode'  `like %mode`,`%`匹配任意多个字符，`_`匹配任意单个字符

修改严格模式：

1. `set session`：只在当前窗口有效，退出了就失效了。
2. `set global`：全局有效

修改为严格模式

```sql
set global sql_mode = 'STRICT_TRANS_TABLES';
```

设置完需要退出服务端重新进入一下。

### 3、数据类型

#### 3.1 整型

分类：

1. `int`：4个字节，32位,从-2^31(-2,147,483,648)到2^31-1(2,147,483,647)的整型数据
2. `smallint`：2个字节，16位,从-2^15(-32,768)到2^15-1(32,767)的整数数据
3. `bigint`：8个字节，64位,从-2^63(-9223372036854775808)到2^63-1(9223372036854775807)的整型数据
4. `tinyint`：1个字节，8位,无符号：从0到255的整数数据，有符号：-128~127

整型默认情况下都是带有符号的。

以`tinyint`为例

```sql
create table t9(id tinyint);
-- +-------+------------+------+-----+---------+-------+
-- | Field | Type       | Null | Key | Default | Extra |
-- +-------+------------+------+-----+---------+-------+
-- | id    | tinyint(4) | YES  |     | NULL    |       |
-- +-------+------------+------+-----+---------+-------+

insert into t9 values(-129),(256);
select * from t9;

-- tinyint默认是有符号的所以结果会只存到tinyint接受的最大范围`-128,127`，严格模式会直接报错，插不进去

-- 取消符号
create table t10 (id tinyint unsigned);
desc t10;
-- +-------+---------------------+------+-----+---------+-------+
-- | Field | Type                | Null | Key | Default | Extra |
-- +-------+---------------------+------+-----+---------+-------+
-- | id    | tinyint(3) unsigned | YES  |     | NULL    |       |
-- +-------+---------------------+------+-----+---------+-------+
```

针对整型，括号内的宽度问题

- int(8): 如果数字没有超出8位，那么默认用空格填充
- 如果数字超出了8位，那么有几位就存几位，遵循最大值

```sql
mysql> create table t12(id int(8));
-- Query OK, 0 rows affected (0.01 sec)

mysql> insert into t12 values(123456789);
-- Query OK, 1 row affected (0.00 sec)

mysql> select * from t12;
-- +-----------+
-- | id        |
-- +-----------+
-- | 123456789 |
-- +-----------+
-- 1 row in set (0.00 sec)

```

会发现设置了8位，但是存9位存进去了。所以只有整型括号的数字不是表示限制位数，而是显示长度。

但是如果不想要默认的`空格`填充，可以加约束

```sql
-- 无符号。用0填充
create table t13 (id int unsigned zerofill)
```

所以针对整型字段，括号内无需指定宽度，默认的宽度足以足够显示所有数据。

#### 3.2 浮点型

分类：

1. float(255,30)：单精度，浮点数值,总共255位，小数部分占30位
2. double(255,30)：双精度，浮点数值，总共255位，小数部分占30位
3. decimal(65,30)：小数值，总共65位，小数部分占30位

精确度：float < double < decimal
