---
layout: post
title: 前端模块化规范
categories: javascript
description: 前端模块化规范
keywords: JavaScript, ES6, CJS, module
---

记录一下前端各种模块化规范的区别和特性。

### 1、ES6模块

`ES6模块`是ECMAScript 2015 提出的模块化规范。他有严格的申明要求。

1. 必须在文件的首部
2. 不允许使用变量或表达式
3. 不允许被嵌入到其他语句中

#### 1.1 使用方式

1. 直接使用 `<script>` 标签加载  `<script src='xxx' type='module'><>`
2. 通过import静态引入 `import xxx from "module-xxx";`

#### 1.2 使用注意

- ES6模块强制自动采用严格模式，所以说不管有没有“user strict”声明都是一样的，换言之，编写代码的时候不必再刻意声明了；
- 虽然大部分主流浏览器支持 ES6 模块，但是和引入普通 JS 的方式略有不同，需要在对应 script 标签中将属性 type 值设置为“module”才能被正确地解析为 ES6 模块；
- 在 Node.js 下使用 ES6 模块则需要将文件名后缀改为“.mjs”，用来和 Node.js 默认使用的 CommonJS 规范模块作区分。

#### 1.3 特性

ES6 模块有两个重要特性一定要掌握，一个是`值引用`，另一个是`静态声明`。

- 值引用：值引用是指`export`语句输出的接口与其对应的值是动态绑定的关系，意思是通过他获取的值会随着模块内部的修改而改变，类似于对象的浅拷贝。
- 静态声明：静态分析是指不需要执行代码，只从字面量上对代码进行分析。好处是方便优化代码体积，比如通过`Tree-shaking`操作消除模块中没有被引用或者执行结果不会被用到的无用代码。

#### 1.4 动态导入

静态导入可以直接`import`，动态导入就需要`import()`了。调用 `import()`函数传入模块路径，得到一个`Promise`对象。

```js
let promise = import("module-promise");
```

同时动态导入还支持`await / async`

```js
let promise = await import("module-promise");
```

在`webpack`打包的时候，在调用了`import()`的地方，请求的模块及其子模块会被分到单独的chunk里面。
